--서브쿼리 실습 1번
SELECT EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE DEPT_CODE = (
SELECT DEPT_ID FROM DEPARTMENT
WHERE DEPT_TITLE IN('기술지원부'));

--서브쿼리 실습 2번
WITH RANK AS(
SELECT EMP_NAME, DEPT_ID, SALARY FROM DEPARTMENT
JOIN EMPLOYEE ON DEPT_ID = DEPT_CODE
WHERE DEPT_TITLE IN('기술지원부')
ORDER BY SALARY DESC)

SELECT EMP_NAME, DEPT_ID, SALARY
FROM RANK WHERE ROWNUM=1;

--서브쿼리 실습 3번
SELECT EMP_ID,EMP_NAME, 
SALARY, MANAGER_ID
FROM EMPLOYEE WHERE MANAGER_ID IS NOT NULL
AND SALARY > (SELECT AVG(SALARY) FROM EMPLOYEE);

--서브쿼리 실습 4번
SELECT EMP_NAME, JOB_CODE, SALARY, SAL_LEVEL
FROM EMPLOYEE WHERE (JOB_CODE, SAL_LEVEL) IN 
(SELECT JOB_CODE, MIN(SAL_LEVEL) FROM EMPLOYEE
GROUP BY JOB_CODE);

--서브쿼리 실습 5번
SELECT DEPT_CODE, DEPT_TITLE, SALARY
FROM (SELECT DEPT_CODE, FLOOR(AVG(SALARY)) AS SALARY
FROM EMPLOYEE GROUP BY DEPT_CODE)
LEFT JOIN DEPARTMENT ON DEPT_CODE=DEPT_ID
WHERE SALARY > 2200000;

--서브쿼리 실습 6번
WITH SUB AS (
SELECT E.EMP_NAME AS "이름", 
E.EMP_NO AS "주민번호", 
J.JOB_NAME AS 직급명, 
D.DEPT_TITLE AS "부서명",
E.SALARY*12+E.SALARY*NVL(E.BONUS,0) AS "연봉"
, E.JOB_CODE
FROM EMPLOYEE E LEFT JOIN DEPARTMENT D 
ON DEPT_CODE = DEPT_ID
LEFT JOIN JOB J ON E.JOB_CODE = J.JOB_CODE
WHERE SUBSTR(E.EMP_NO,8,1)=2)

SELECT "이름", "주민번호", "직급명", "부서명", "연봉"
FROM SUB JOIN 
(SELECT JOB_CODE, 
FLOOR(AVG((SALARY*12)+(SALARY*NVL(BONUS,0)))) 
AS "평균연봉" 
FROM EMPLOYEE GROUP BY JOB_CODE) 
A ON SUB.JOB_CODE =A.JOB_CODE
WHERE "연봉" > "평균연봉"
ORDER BY "이름" ASC;